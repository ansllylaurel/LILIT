═══════════════════════════════════════════════════════════════
  КАК ЗАПУСТИТЬ БОТА НА СЕРВЕРЕ — ПРОСТЫМИ СЛОВАМИ
═══════════════════════════════════════════════════════════════

Что это вообще?
  Сейчас бот работает у тебя на компьютере: пока открыто окно run.bat — бот отвечает. Закрыл компьютер — бот "уснул".
  Сервер — это чужой компьютер в интернете, который включён всегда. Если запустить бота там, он будет работать 24 часа, даже когда твой комп выключен.

Что тебе понадобится?
  1. Сервер (VPS) с Ubuntu 22.04 — его можно арендовать (платно, копейки в месяц). Например: Timeweb, Selectel, Reg.ru, или зарубежные DigitalOcean, Hetzner.
  2. Адрес сервера, логин и пароль (или ключ) — их даёт тот, у кого арендуешь.
  3. Твой бот уже залит в Git (GitHub, GitLab или свой репозиторий). Если нет — сначала залей код в репозиторий.

Как подключиться к серверу?
  На Windows можно открыть программу "Терминал" (PowerShell) или установить PuTTY. Ты как бы "заходишь" на чужой компьютер по интернету.
  Команда будет такая (подставь свой адрес и логин):
    ssh логин@адрес_сервера
  Пример: ssh root@123.45.67.89
  Введут пароль — и ты уже "внутри" сервера. Дальше все команды ты вводишь там, в этом чёрном окне.

───────────────────────────────────────────────────────────────
ШАГ 1. ОБНОВИТЬ СЕРВЕР
───────────────────────────────────────────────────────────────
  Зачем: чтобы на сервере стояли свежие программы и не было дыр.
  Что делать: в окне, где ты подключился к серверу, ввести одну строку и нажать Enter:

    sudo apt update && sudo apt upgrade -y

  Подожди, пока всё докачается. Может спросить пароль — введи тот, что дали при аренде.

───────────────────────────────────────────────────────────────
ШАГ 2. СОЗДАТЬ "ПОЛЬЗОВАТЕЛЯ" ДЛЯ БОТА
───────────────────────────────────────────────────────────────
  Зачем: бота лучше запускать не от главного пользователя (root), а от отдельного — так безопаснее. Мы назовём его "bot".
  Что делать: ввести по очереди две команды.

  Команда 1 — создать пользователя bot и папку для бота:

    sudo useradd --system --shell /bin/bash --home-dir /opt/telegram-bot --create-home bot

  Команда 2 — сделать так, чтобы папка /opt/telegram-bot принадлежала пользователю bot:

    sudo chown -R bot:bot /opt/telegram-bot

  Ничего не должно "ругаться". Если написал что-то красное — скопируй и покажи тому, кто разбирается.

───────────────────────────────────────────────────────────────
ШАГ 3. УСТАНОВИТЬ GIT (ЕСЛИ ЕГО НЕТ)
───────────────────────────────────────────────────────────────
  Зачем: Git — это программа, которая "скачивает" твой код с GitHub (или другого сайта) на сервер.
  Что делать: ввести:

    sudo apt install -y git

  Подожди "Done" или "Готово".

───────────────────────────────────────────────────────────────
ШАГ 4. ЗАЙТИ КАК ПОЛЬЗОВАТЕЛЬ BOT И СКАЧАТЬ КОД БОТА
───────────────────────────────────────────────────────────────
  Зачем: мы переключаемся на пользователя "bot" и в его папку скачиваем проект.
  Что делать: по очереди.

  4.1 Зайти под пользователем bot:

    sudo su - bot

  После этого в начале строки должно появиться что-то вроде bot@имя_сервера. Значит, ты теперь "bot".

  4.2 Перейти в папку бота:

    cd /opt/telegram-bot

  4.3 Скачать код из твоего репозитория. Вместо ссылки ниже подставь СВОЮ (из GitHub/GitLab — кнопка "Code" → копировать ссылку):

    git clone твоя_ссылка_на_репозиторий .

  Важно: в конце команды стоит точка и пробел перед ней. Она значит "скачать сюда, в текущую папку".
  Пример (не твой!): git clone https://github.com/username/лилит.git .

  Если репозиторий приватный — тебя спросят логин и пароль (или токен). Введи их.

───────────────────────────────────────────────────────────────
ШАГ 5. СОЗДАТЬ "ВИРТУАЛЬНОЕ ОКРУЖЕНИЕ" И УСТАНОВИТЬ БИБЛИОТЕКИ
───────────────────────────────────────────────────────────────
  Зачем: на сервере нужны те же программы (aiogram, httpx и т.д.), что и у тебя в requirements.txt. Чтобы не мешать с другими проектами, делают "отдельную коробку" — venv.
  Что делать: ты всё ещё под пользователем bot, в папке /opt/telegram-bot.

  5.1 Создать эту "коробку":

    python3 -m venv venv

  5.2 Включить её (как будто залезаешь в коробку):

    source venv/bin/activate

  В начале строки появится (venv) — значит, включено.

  5.3 Обновить pip и поставить библиотеки из requirements.txt:

    pip install --upgrade pip
    pip install -r requirements.txt

  Подожди, пока всё установится.

───────────────────────────────────────────────────────────────
ШАГ 6. СОЗДАТЬ ФАЙЛ .env И ВСТАВИТЬ ТОКЕНЫ
───────────────────────────────────────────────────────────────
  Зачем: бот читает токены (Telegram, ключ нейросети) из файла .env. Без него бот не запустится.
  Что делать:

  6.1 Скопировать пример:

    cp .env.example .env

  6.2 Открыть .env в редакторе:

    nano .env

  6.3 В файле будут строки типа TELEGRAM_BOT_TOKEN=... и DEEPSEEK_API_KEY=...
  Замени "your_..." на свои настоящие токены (как делал на своём компе). Двигайся стрелками, стирай и вводишь.
  Сохранить: нажать Ctrl+O, потом Enter. Выйти: Ctrl+X.

  6.4 Сделать файл секретным (чтобы другие пользователи сервера не могли его прочитать):

    chmod 600 .env

───────────────────────────────────────────────────────────────
ШАГ 7. ПРОВЕРИТЬ, ЧТО БОТ ВООБЩЕ ЗАПУСКАЕТСЯ
───────────────────────────────────────────────────────────────
  Зачем: убедиться, что на сервере всё настроено и бот откликается, прежде чем делать автозапуск.
  Что делать: ты всё ещё под bot, venv включён (видно по (venv) в строке).

  Запустить бота вручную:

    python -m bot.main

  Должны пойти строчки вроде "Бот запущен", "Start polling". Открой Telegram и напиши боту — он должен ответить.
  Остановить бота: нажать Ctrl+C.

  Потом выйти из пользователя bot:

    exit

───────────────────────────────────────────────────────────────
ШАГ 8. СДЕЛАТЬ ТАК, ЧТОБЫ БОТ ЗАПУСКАЛСЯ САМ И НЕ ПАДАЛ
───────────────────────────────────────────────────────────────
  Зачем: чтобы после перезагрузки сервера бот сам поднялся, и если он упадёт — перезапустился.
  Для этого на Linux используют "сервис" (systemd). Мы создаём один файл-инструкцию для системы.

  8.1 Выйди из пользователя bot (если ещё не вышел): введи exit. Ты снова под root или ubuntu.

  8.2 Создать файл сервиса:

    sudo nano /etc/systemd/system/telegram-bot.service

  8.3 В открывшийся пустой файл вставь ВЕСЬ текст ниже (от [Unit] до multi-user.target включительно). Можно копировать по частям.

────────────────────────────────────────────────────────────────
[Unit]
Description=Telegram bot (Lilit, polling)
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=bot
Group=bot
WorkingDirectory=/opt/telegram-bot
Environment=PATH=/opt/telegram-bot/venv/bin
ExecStart=/opt/telegram-bot/venv/bin/python -m bot.main
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal
SyslogIdentifier=telegram-bot

[Install]
WantedBy=multi-user.target
────────────────────────────────────────────────────────────────

  Что это значит простыми словами:
  - User=bot — запускать от пользователя bot.
  - WorkingDirectory=/opt/telegram-bot — работать в папке бота (там лежит .env).
  - ExecStart=... — команда запуска: наш python из venv и bot.main.
  - Restart=always — если бот упал, перезапустить через 5 секунд (RestartSec=5).
  - WantedBy=multi-user.target — запускать бота при включении сервера.

  Сохранить: Ctrl+O, Enter. Выйти: Ctrl+X.

  8.4 Сказать системе "прочитай новый сервис":

    sudo systemctl daemon-reload

  8.5 Включить автозапуск бота при старте сервера:

    sudo systemctl enable telegram-bot.service

  8.6 Запустить бота прямо сейчас:

    sudo systemctl start telegram-bot.service

  8.7 Проверить, что он бежит:

    sudo systemctl status telegram-bot.service

  Должно быть зелёным "active (running)". Напиши боту в Telegram — должен отвечать.

───────────────────────────────────────────────────────────────
ШАГ 9. КАК ПОТОМ СМОТРЕТЬ ЛОГИ И УПРАВЛЯТЬ БОТОМ
───────────────────────────────────────────────────────────────
  Всё это вводится уже не под пользователем bot, а под тем, с кем ты заходил на сервер (root/ubuntu), и с sudo.

  Смотреть логи в реальном времени (как вывод бота в консоль):
    sudo journalctl -u telegram-bot.service -f
  Выход: Ctrl+C.

  Остановить бота:
    sudo systemctl stop telegram-bot.service

  Запустить бота:
    sudo systemctl start telegram-bot.service

  Перезапустить бота (например, после смены .env):
    sudo systemctl restart telegram-bot.service

  Посмотреть, запущен ли бот:
    sudo systemctl status telegram-bot.service

───────────────────────────────────────────────────────────────
ШАГ 10. КАК ОБНОВИТЬ КОД БОТА (ТЫ ЧТО-ТО ИЗМЕНИЛ В GIT)
───────────────────────────────────────────────────────────────
  Зайти под bot, подтянуть новый код, обновить библиотеки, выйти и перезапустить сервис.

  Команды по порядку:

    sudo su - bot
    cd /opt/telegram-bot
    git pull
    source venv/bin/activate
    pip install -r requirements.txt
    exit
    sudo systemctl restart telegram-bot.service

  После этого бот уже работает с новым кодом. Проверь в Telegram.

───────────────────────────────────────────────────────────────
ЕСЛИ ЧТО-ТО ПОШЛО НЕ ТАК
───────────────────────────────────────────────────────────────
  - Пишет "TELEGRAM_BOT_TOKEN не задан" — открой .env (nano /opt/telegram-bot/.env под пользователем bot) и проверь, что токены вписаны без лишних пробелов и кавычек.
  - Бот не стартует — посмотри логи: sudo journalctl -u telegram-bot.service -n 50. Там будет красная ошибка; по ней можно искать в интернете или спросить того, кто знает.
  - "Permission denied" — возможно, забыли chown (шаг 2) или заходишь не под тем пользователем. Проверь, что папка /opt/telegram-bot принадлежит bot.
  - Не можешь клонировать репозиторий — проверь ссылку и что у тебя есть доступ (логин/токен для приватного репо).

───────────────────────────────────────────────────────────────
КОРОТКО: ЧТО МЫ СДЕЛАЛИ
───────────────────────────────────────────────────────────────
  1. Обновили сервер.
  2. Создали пользователя bot и папку /opt/telegram-bot.
  3. Скачали туда код бота из Git.
  4. Создали venv и установили библиотеки.
  5. Создали .env и вставили токены.
  6. Проверили ручной запуск.
  7. Создали systemd-сервис telegram-bot.service, включили автозапуск и запустили бота.
  Теперь бот крутится на сервере 24/7 и перезапускается сам при сбоях.
